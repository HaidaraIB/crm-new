#!/bin/bash

# ุณูุฑูุจุช ุชุญุฏูุซ CRM-project ุนูู VPS
# ุงูุงุณุชุฎุฏุงู: ./update.sh

set -e  # ุฅููุงู ุงูุชูููุฐ ุนูุฏ ุญุฏูุซ ุฎุทุฃ

echo "๐ ุจุฏุก ุชุญุฏูุซ CRM-project..."

# ุงูุงูุชูุงู ุฅูู ูุฌูุฏ ุงููุดุฑูุน
cd "$(dirname "$0")"

# ุงูุชุญูู ูู ูุฌูุฏ Git
if [ -d ".git" ]; then
    echo "๐ฅ ุฌูุจ ุงูุชุญุฏูุซุงุช ูู Git..."
    git pull origin main || git pull origin master
else
    echo "โ๏ธ  Git ุบูุฑ ููุฌูุฏุ ุณูุชู ุชุฎุทู ุชุญุฏูุซุงุช Git"
fi

# ุชุซุจูุช/ุชุญุฏูุซ ุงูุชุจุนูุงุช
echo "๐ฆ ุชุซุจูุช ุงูุชุจุนูุงุช..."
npm install

# ุจูุงุก ุงููุดุฑูุน
echo "๐จ ุจูุงุก ุงููุดุฑูุน..."
npm run build

# ุฅุนุงุฏุฉ ุชุญููู Nginx
echo "๐ ุฅุนุงุฏุฉ ุชุญููู Nginx..."
sudo nginx -t && sudo systemctl reload nginx

echo "โ ุชู ุชุญุฏูุซ ุงููุดุฑูุน ุจูุฌุงุญ!"
echo "๐ ุงูููุช: $(date)"

